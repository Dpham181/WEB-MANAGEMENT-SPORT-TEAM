DROP DATABASE IF EXISTS SPORTS_MANAGEMENT;
CREATE DATABASE IF NOT EXISTS SPORTS_MANAGEMENT;
DROP USER IF EXISTS 'manager'@'localhost';
GRANT SELECT, INSERT, DELETE, UPDATE
ON SPORTS_MANAGEMENT.*
TO 'manager'@'localhost' IDENTIFIED BY '123456';
USE SPORTS_MANAGEMENT;

CREATE TABLE USERS
(
  USER_ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  PASSWORD_HASH varchar(225) COLLATE utf8_unicode_ci NOT NULL,
  EMAIL varchar(50) COLLATE utf8_unicode_ci NOT NULL,
  TYPE varchar(1) COLLATE utf8_unicode_ci NOT NULL DEFAULT 'U'
);

CREATE TABLE MANAGER
(
  MANAGER_ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  MUSER_ID INT(10) UNSIGNED NOT NULL,

  CONSTRAINT FOREIGN KEY (MUSER_ID) REFERENCES USERS(USER_ID)
);

CREATE TABLE PROFILE
(
  PROFILE_ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  PUSER_ID INT(10) UNSIGNED NOT NULL,
  FIRST_NAME VARCHAR(100),
  LAST_NAME VARCHAR(150) NOT NULL,
  COUNTRY VARCHAR(250),
  ZIPCODE VARCHAR(100),
  CITY VARCHAR(100),
  STREET VARCHAR(100),
  STATE CHAR(10),

  CONSTRAINT FOREIGN KEY (PUSER_ID) REFERENCES USERS(USER_ID),
  CHECK (ZIPCODE  REGEXP '(?!0{5})(?!9{5})\\d{5}(-(?!0{4})(?!9{4})\\d{4})?'),
  INDEX (LAST_NAME ),
  UNIQUE (FIRST_NAME , LAST_NAME )
);

CREATE TABLE TEAMS
(
  TEAM_ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  TMANAGER_ID INT(10) UNSIGNED NOT NULL,
  TEAM_NAME  VARCHAR(100),
  WIN TINYINT(3) UNSIGNED DEFAULT 0,
  LOSS TINYINT(3) UNSIGNED DEFAULT 0,

  FOREIGN KEY (TMANAGER_ID) REFERENCES MANAGER(MANAGER_ID)
);

CREATE TABLE GAMES
(
  GAME_ID INT(10) UNSIGNED NOT NULL PRIMARY KEY,
  START_DAY VARCHAR(100),
  END_DAY VARCHAR(150) NOT NULL
);


CREATE TABLE PLAYER
(
  PLAYER_ID INT(10) UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
  FIRST_NAME VARCHAR(100),
  LAST_NAME VARCHAR(150) NOT NULL,
  PLTEAM_ID INT(10) UNSIGNED NOT NULL,

  CONSTRAINT FOREIGN KEY (PLTEAM_ID) REFERENCES TEAMS(TEAM_ID),

  CHECK (ZipCode REGEXP '(?!0{5})(?!9{5})\\d{5}(-(?!0{4})(?!9{4})\\d{4})?'),
  INDEX (LAST_NAME ),
  INDEX (FIRST_NAME, LAST_NAME)
);

CREATE TABLE STATS
(
  SPLAYER_ID INT(10) UNSIGNED NOT NULL,
  SGAME_ID INT(10) UNSIGNED NOT NULL,
  PLAYINGTIMEMIN TINYINT(2) UNSIGNED DEFAULT 0,
  PLAYINGTIMESEC TINYINT(2) UNSIGNED DEFAULT 0,
  POINTS TINYINT(3) UNSIGNED DEFAULT 0,
  ASSISTS TINYINT(3) UNSIGNED DEFAULT 0,
  REBOUNDS TINYINT(3) UNSIGNED DEFAULT 0,
  THREE_POINTS TINYINT(3) UNSIGNED DEFAULT 0,
  FTA TINYINT(3) UNSIGNED DEFAULT 0,
  STEAL TINYINT(3) UNSIGNED DEFAULT 0,
  FOUL TINYINT(3) UNSIGNED DEFAULT 0,
  BLOCK TINYINT(3) UNSIGNED DEFAULT 0,
  FTM TINYINT(3) UNSIGNED DEFAULT 0,

  PRIMARY KEY(SPLAYER_ID,SGAME_ID),

  CONSTRAINT FOREIGN KEY (SPLAYER_ID) REFERENCES PLAYER(PLAYER_ID),
  CONSTRAINT FOREIGN KEY (SGAME_ID) REFERENCES GAMES(GAME_ID),

  CHECK((PLAYINGTIMEMIN < 40 AND PLAYINGTIMESEC < 60) OR
        (PLAYINGTIMEMIN = 40 AND PLAYINGTIMESEC = 0 ))
);

CREATE TABLE PLAY
(
  PGAME_ID INT(10) UNSIGNED NOT NULL,
  PTEAM_ID INT(10) UNSIGNED NOT NULL,
  SCORE TINYINT(3) UNSIGNED DEFAULT 0,

  PRIMARY KEY(PGAME_ID,PTEAM_ID),

  CONSTRAINT FOREIGN KEY (PTEAM_ID) REFERENCES TEAMS(TEAM_ID),
  CONSTRAINT FOREIGN KEY (PGAME_ID) REFERENCES GAMES(GAME_ID)
);

INSERT INTO USERS VALUES
(1, '$2y$10$2vgZ0.zYbzZGPLO6vjlAquz6BOVOR3d34eCo8hF4pLjFBFyvwcRzS', 'admin@email.com', 'A'),
(2, '$2y$10$2vgZ0.zYbzZGPLO6vjlAquz6BOVOR3d34eCo8hF4pLjFBFyvwcRzS', 'manager@email.com', 'M'),
(3, '$2y$10$2vgZ0.zYbzZGPLO6vjlAquz6BOVOR3d34eCo8hF4pLjFBFyvwcRzS', 'user@email.com', 'U'),
(4, '$2y$10$2vgZ0.zYbzZGPLO6vjlAquz6BOVOR3d34eCo8hF4pLjFBFyvwcRzS', 'manager1@email.com', 'M'),
(5, '$2y$10$2vgZ0.zYbzZGPLO6vjlAquz6BOVOR3d34eCo8hF4pLjFBFyvwcRzS', 'manager2@email.com', 'M');

INSERT INTO MANAGER VALUES
(1, 2),
(2, 4),
(3, 5);

INSERT INTO GAMES VALUES
(1, '04-18-2018', '04-20-2018'),
(2, '05-18-2018', '05-20-2018'),
(3, '06-18-2018', '06-20-2018'),
(4, '07-19-2018', '07-24-2018'),
(5, '08-1-2018', '08-10-2018');

INSERT INTO PROFILE VALUES
(1, 1, 'ADMIN', 'DEMO', 'USA', '12345', 'FULLERTON', '123 MAIN ST', 'CA'),
(2, 2, 'MANAGER', 'DEMO', 'USA', '54321', 'WESMINSTER', '456 BLVD', 'TX'),
(3, 3, 'USER', 'DEMO', 'USA', '12345', 'FULLERTON', '123 MAIN ST', 'CA'),
(4, 4, 'MANAGER1', 'DEMO', 'USA', '12345', 'FULLERTON', '123 MAIN ST', 'CA'),
(5, 5, 'MANAGER2', 'DEMO', 'USA', '12345', 'FULLERTON', '123 MAIN ST', 'CA');


INSERT INTO TEAMS VALUES
(1, 1, 'APPLE', 4, 2),
(2, 2, 'ORANGE', 5, 8),
(3, 3, 'FIRE', 0, 0);

INSERT INTO PLAY VALUES
(1, 1, 10),
(1, 2, 5),
(2, 3, 1),
(2, 1, 2),
(3, 2, 4),
(3, 3, 5),
(4, 1, NULL),
(4, 2, NULL),
(5, 3, NULL),
(5, 2, NULL);

INSERT INTO PLAYER VALUES
(1, 'THOMAS', 'NGO', 1),
(2, 'DANH', 'PHAM', 1),
(3, 'PETER', 'VU', 1),
(4, 'JOHN', 'SMITH', 2),
(5, 'BOB', 'SMITH', 2),
(6, 'JANE', 'NGUYEN', 2),
(7, 'BRUCE', 'WAYNE', 3),
(8, 'TONY', 'STARK', 3),
(9, 'EVE', 'HARRY', 3),
(10, 'BARRY', 'ALAN', 3),
(11, 'CLARK', 'KEN', 3),
(12, 'hello', 'world', 3);

INSERT INTO STATS VALUES
(1, 1, 30, 30, 1, 1, 1, 1, 1, 1, 1, 1, 1),
(2, 1, 25, 39, 1, 2, 3, 4, 5, 6, 7, 8, 9),
(3, 1, 15, 25, 2, 3, 5, 7, 3, 2, 1, 3, 5),
(4, 1, 15, 25, 2, 3, 5, 7, 3, 2, 1, 3, 5),
(5, 1, 15, 25, 2, 3, 5, 7, 3, 2, 1, 3, 5),
(6, 1, 15, 25, 2, 3, 5, 7, 3, 2, 1, 3, 5),
(7, 2, 30, 30, 9, 1, 12, 10, 4, 7, 2, 3, 1),
(8, 2, 30, 30, 1, 1, 1, 2, 1, 0, 0, 0, 1),
(9, 2, 30, 30, 1, 1, 4, 1, 1, 1, 9, 1, 1),
(1, 2, 30, 30, 1, 3, 1, 1, 0, 1, 9, 1, 1),
(2, 2, 30, 30, 7, 1, 1, 0, 2, 1, 9, 1, 1),
(3, 2, 30, 30, 1, 1, 0, 1, 1, 4, 9, 1, 1),
(4, 3, 15, 25, 2, 3, 5, 7, 3, 2, 9, 3, 5),
(5, 3, 15, 25, 2, 3, 5, 7, 3, 2, 1, 3, 5),
(6, 3, 15, 25, 2, 3, 5, 7, 3, 2, 1, 3, 5),
(7, 3, 30, 30, 1, 0, 1, 1, 1, 1, 3, 5, 1),
(8, 3, 30, 30, 1, 1, 0, 1, 1, 4, 1, 1, 1),
(9, 3, 30, 30, 1, 1, 1, 0, 2, 1, 1, 1, 1),
(12, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
